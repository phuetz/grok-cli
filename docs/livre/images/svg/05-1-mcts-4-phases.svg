<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 950 550">
  <defs>
    <style>
      .bg { fill: #f8f9fa; }
      .phase-box { fill: white; stroke: #0f3460; stroke-width: 2; rx: 15; }
      .phase-1 { fill: #e3f2fd; stroke: #1976d2; }
      .phase-2 { fill: #fff3e0; stroke: #f57c00; }
      .phase-3 { fill: #e8f5e9; stroke: #388e3c; }
      .phase-4 { fill: #f3e5f5; stroke: #7b1fa2; }
      .node { stroke-width: 2; }
      .node-default { fill: #fff; stroke: #666; }
      .node-selected { fill: #bbdefb; stroke: #1976d2; stroke-width: 3; }
      .node-expanded { fill: #ffcc80; stroke: #f57c00; stroke-width: 3; }
      .node-simulated { fill: #a5d6a7; stroke: #388e3c; }
      .node-updated { fill: #ce93d8; stroke: #7b1fa2; stroke-width: 3; }
      .text-title { font-family: 'Segoe UI', Arial, sans-serif; font-size: 22px; font-weight: bold; fill: #0f3460; }
      .text-phase { font-family: 'Segoe UI', Arial, sans-serif; font-size: 16px; font-weight: bold; }
      .text-desc { font-family: 'Segoe UI', Arial, sans-serif; font-size: 11px; fill: #555; }
      .text-node { font-family: 'Segoe UI', Arial, sans-serif; font-size: 10px; fill: #333; }
      .text-formula { font-family: 'Courier New', monospace; font-size: 10px; fill: #333; }
      .arrow { stroke: #666; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .arrow-phase { stroke: #0f3460; stroke-width: 3; fill: none; marker-end: url(#arrowhead-blue); }
      .path-highlight { stroke: #1976d2; stroke-width: 3; fill: none; }
    </style>
    <marker id="arrowhead" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#666"/>
    </marker>
    <marker id="arrowhead-blue" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#0f3460"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect class="bg" width="950" height="550"/>

  <!-- Title -->
  <text x="475" y="35" text-anchor="middle" class="text-title">MCTS : Les 4 Phases (Select → Expand → Simulate → Backpropagate)</text>

  <!-- Phase arrows at top -->
  <path d="M 130 60 L 280 60" class="arrow-phase"/>
  <path d="M 350 60 L 500 60" class="arrow-phase"/>
  <path d="M 570 60 L 720 60" class="arrow-phase"/>
  <path d="M 790 60 L 920 60" class="arrow-phase"/>
  <path d="M 920 60 Q 950 60 950 90 L 950 500 Q 950 530 920 530 L 130 530 Q 100 530 100 500 L 100 90 Q 100 60 130 60" stroke="#0f3460" stroke-width="2" fill="none" stroke-dasharray="5,5"/>

  <!-- Phase 1: Selection -->
  <rect x="20" y="80" width="210" height="420" class="phase-box phase-1"/>
  <text x="125" y="105" text-anchor="middle" class="text-phase" fill="#1976d2">1. SELECTION</text>
  <text x="125" y="122" text-anchor="middle" class="text-desc">Choisir le meilleur chemin</text>

  <!-- Tree for phase 1 -->
  <circle cx="125" cy="170" r="18" class="node node-selected"/>
  <text x="125" y="175" text-anchor="middle" class="text-node">5/10</text>

  <line x1="110" y1="188" x2="80" y2="230" class="path-highlight"/>
  <line x1="140" y1="188" x2="170" y2="230" stroke="#666" stroke-width="1"/>

  <circle cx="80" cy="250" r="16" class="node node-selected"/>
  <text x="80" y="254" text-anchor="middle" class="text-node">3/5</text>

  <circle cx="170" cy="250" r="16" class="node node-default"/>
  <text x="170" y="254" text-anchor="middle" class="text-node">2/5</text>

  <line x1="68" y1="265" x2="50" y2="300" class="path-highlight"/>
  <line x1="92" y1="265" x2="110" y2="300" stroke="#666" stroke-width="1"/>

  <circle cx="50" cy="320" r="16" class="node node-selected"/>
  <text x="50" y="324" text-anchor="middle" class="text-node">2/3</text>

  <circle cx="110" cy="320" r="16" class="node node-default"/>
  <text x="110" y="324" text-anchor="middle" class="text-node">1/2</text>

  <!-- UCB1 formula -->
  <rect x="30" y="380" width="190" height="50" fill="#e3f2fd" stroke="#1976d2" rx="5"/>
  <text x="125" y="400" text-anchor="middle" class="text-formula">UCB1 = Wi/Ni +</text>
  <text x="125" y="418" text-anchor="middle" class="text-formula">C * sqrt(ln(N)/Ni)</text>

  <text x="125" y="455" text-anchor="middle" class="text-desc">Wi = victoires, Ni = visites</text>
  <text x="125" y="470" text-anchor="middle" class="text-desc">C = constante exploration</text>

  <!-- Phase 2: Expansion -->
  <rect x="250" y="80" width="210" height="420" class="phase-box phase-2"/>
  <text x="355" y="105" text-anchor="middle" class="text-phase" fill="#f57c00">2. EXPANSION</text>
  <text x="355" y="122" text-anchor="middle" class="text-desc">Ajouter un nouveau noeud</text>

  <!-- Tree for phase 2 -->
  <circle cx="355" cy="170" r="18" class="node node-default"/>
  <text x="355" y="175" text-anchor="middle" class="text-node">5/10</text>

  <line x1="340" y1="188" x2="310" y2="230" stroke="#666" stroke-width="1"/>
  <line x1="370" y1="188" x2="400" y2="230" stroke="#666" stroke-width="1"/>

  <circle cx="310" cy="250" r="16" class="node node-default"/>
  <text x="310" y="254" text-anchor="middle" class="text-node">3/5</text>

  <circle cx="400" cy="250" r="16" class="node node-default"/>
  <text x="400" y="254" text-anchor="middle" class="text-node">2/5</text>

  <line x1="298" y1="265" x2="280" y2="300" stroke="#666" stroke-width="1"/>
  <line x1="322" y1="265" x2="340" y2="300" stroke="#666" stroke-width="1"/>

  <circle cx="280" cy="320" r="16" class="node node-selected"/>
  <text x="280" y="324" text-anchor="middle" class="text-node">2/3</text>

  <circle cx="340" cy="320" r="16" class="node node-default"/>
  <text x="340" y="324" text-anchor="middle" class="text-node">1/2</text>

  <!-- New expanded node -->
  <line x1="280" y1="336" x2="280" y2="380" stroke="#f57c00" stroke-width="3"/>
  <circle cx="280" cy="400" r="18" class="node node-expanded"/>
  <text x="280" y="404" text-anchor="middle" class="text-node" font-weight="bold">0/0</text>
  <text x="280" y="435" text-anchor="middle" class="text-desc" fill="#f57c00">Nouveau!</text>

  <text x="355" y="480" text-anchor="middle" class="text-desc">Genere une nouvelle</text>
  <text x="355" y="495" text-anchor="middle" class="text-desc">pensee/action</text>

  <!-- Phase 3: Simulation -->
  <rect x="480" y="80" width="210" height="420" class="phase-box phase-3"/>
  <text x="585" y="105" text-anchor="middle" class="text-phase" fill="#388e3c">3. SIMULATION</text>
  <text x="585" y="122" text-anchor="middle" class="text-desc">Jouer jusqu'au bout</text>

  <!-- Tree for phase 3 (simplified) -->
  <circle cx="585" cy="170" r="18" class="node node-default"/>
  <text x="585" y="175" text-anchor="middle" class="text-node">5/10</text>

  <line x1="585" y1="188" x2="585" y2="230" stroke="#666" stroke-width="1"/>
  <text x="600" y="215" class="text-desc">...</text>

  <circle cx="585" cy="250" r="16" class="node node-expanded"/>
  <text x="585" y="254" text-anchor="middle" class="text-node">0/0</text>

  <!-- Simulation rollout -->
  <line x1="585" y1="266" x2="585" y2="300" stroke="#388e3c" stroke-width="2" stroke-dasharray="4,2"/>
  <circle cx="585" cy="320" r="14" class="node node-simulated"/>
  <line x1="585" y1="334" x2="585" y2="360" stroke="#388e3c" stroke-width="2" stroke-dasharray="4,2"/>
  <circle cx="585" cy="378" r="14" class="node node-simulated"/>
  <line x1="585" y1="392" x2="585" y2="418" stroke="#388e3c" stroke-width="2" stroke-dasharray="4,2"/>

  <!-- Result -->
  <rect x="555" y="425" width="60" height="30" fill="#c8e6c9" stroke="#388e3c" rx="5"/>
  <text x="585" y="445" text-anchor="middle" class="text-node" fill="#2e7d32" font-weight="bold">WIN!</text>

  <text x="585" y="480" text-anchor="middle" class="text-desc">Rollout aleatoire ou</text>
  <text x="585" y="495" text-anchor="middle" class="text-desc">heuristique rapide</text>

  <!-- Phase 4: Backpropagation -->
  <rect x="710" y="80" width="220" height="420" class="phase-box phase-4"/>
  <text x="820" y="105" text-anchor="middle" class="text-phase" fill="#7b1fa2">4. BACKPROPAGATION</text>
  <text x="820" y="122" text-anchor="middle" class="text-desc">Remonter le resultat</text>

  <!-- Tree for phase 4 with updates -->
  <circle cx="820" cy="170" r="18" class="node node-updated"/>
  <text x="820" y="175" text-anchor="middle" class="text-node">6/11</text>
  <text x="855" y="175" class="text-desc" fill="#7b1fa2">+1</text>

  <line x1="805" y1="188" x2="775" y2="230" stroke="#7b1fa2" stroke-width="3"/>
  <line x1="835" y1="188" x2="865" y2="230" stroke="#666" stroke-width="1"/>

  <circle cx="775" cy="250" r="16" class="node node-updated"/>
  <text x="775" y="254" text-anchor="middle" class="text-node">4/6</text>
  <text x="805" y="254" class="text-desc" fill="#7b1fa2">+1</text>

  <circle cx="865" cy="250" r="16" class="node node-default"/>
  <text x="865" y="254" text-anchor="middle" class="text-node">2/5</text>

  <line x1="763" y1="265" x2="745" y2="300" stroke="#7b1fa2" stroke-width="3"/>
  <line x1="787" y1="265" x2="805" y2="300" stroke="#666" stroke-width="1"/>

  <circle cx="745" cy="320" r="16" class="node node-updated"/>
  <text x="745" y="324" text-anchor="middle" class="text-node">3/4</text>
  <text x="775" y="324" class="text-desc" fill="#7b1fa2">+1</text>

  <circle cx="805" cy="320" r="16" class="node node-default"/>
  <text x="805" y="324" text-anchor="middle" class="text-node">1/2</text>

  <line x1="745" y1="336" x2="745" y2="380" stroke="#7b1fa2" stroke-width="3"/>
  <circle cx="745" cy="400" r="18" class="node node-updated"/>
  <text x="745" y="404" text-anchor="middle" class="text-node" font-weight="bold">1/1</text>
  <text x="780" y="404" class="text-desc" fill="#7b1fa2">+1</text>

  <text x="820" y="465" text-anchor="middle" class="text-desc">Incremente Wi et Ni</text>
  <text x="820" y="480" text-anchor="middle" class="text-desc">de tous les ancetres</text>
  <text x="820" y="495" text-anchor="middle" class="text-desc">sur le chemin</text>

  <!-- Source reference -->
  <text x="920" y="540" text-anchor="end" font-size="10" fill="#999">Ch.05 - Monte-Carlo Tree Search</text>
</svg>
