<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 900">
  <defs>
    <linearGradient id="bgGradTC2" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#1a1a2e;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#16213e;stop-opacity:1" />
    </linearGradient>
  </defs>

  <!-- Background -->
  <rect width="800" height="900" fill="url(#bgGradTC2)"/>

  <!-- Title -->
  <text x="400" y="25" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#ffffff" text-anchor="middle">TRACE COMPLETE : "Corrige le bug dans calculateTotal"</text>

  <!-- Round 1 -->
  <rect x="30" y="40" width="740" height="155" rx="8" fill="#1e3a3a" stroke="#2ecc71" stroke-width="2"/>
  <text x="50" y="60" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#2ecc71">ROUND 1 : Reception et contextualisation</text>

  <text x="50" y="80" font-family="Arial, sans-serif" font-size="9" fill="#cccccc">1. ORCHESTRATEUR recoit le message</text>
  <text x="70" y="93" font-family="monospace" font-size="8" fill="#888888">→ Ajoute a l'historique : { role: 'user', content: '...' }</text>

  <text x="50" y="110" font-family="Arial, sans-serif" font-size="9" fill="#cccccc">2. REASONING evalue la complexite</text>
  <text x="70" y="123" font-family="monospace" font-size="8" fill="#888888">→ Detecte "bug", "debug" → Active Chain-of-Thought (L1)</text>

  <text x="50" y="140" font-family="Arial, sans-serif" font-size="9" fill="#cccccc">3. MEMORY recupere le contexte (RAG search "calculateTotal")</text>
  <text x="70" y="153" font-family="monospace" font-size="8" fill="#888888">→ Trouve : src/utils/math.ts (0.94) + types.ts, constants.ts</text>

  <text x="50" y="170" font-family="Arial, sans-serif" font-size="9" fill="#cccccc">4. LLM appele → tool_call(read_file, { path: "src/utils/math.ts" })</text>
  <text x="50" y="185" font-family="Arial, sans-serif" font-size="9" fill="#2ecc71">5. SECURITY verifie → read_file = auto-approved</text>

  <!-- Round 2 -->
  <rect x="30" y="205" width="740" height="90" rx="8" fill="#3a3a1e" stroke="#f39c12" stroke-width="2"/>
  <text x="50" y="225" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#f39c12">ROUND 2 : Analyse du code</text>

  <text x="50" y="248" font-family="Arial, sans-serif" font-size="9" fill="#cccccc">7. LLM analyse le code recu</text>
  <text x="70" y="261" font-family="monospace" font-size="8" fill="#888888">→ Thinking : "Je vois une fonction calculateTotal qui..."</text>
  <text x="70" y="274" font-family="monospace" font-size="8" fill="#888888">→ Identifie un probleme potentiel ligne 45</text>

  <text x="50" y="291" font-family="Arial, sans-serif" font-size="9" fill="#f39c12">8. ACTION execute la recherche → Trouve : ligne 45, total / divisor sans verification</text>

  <!-- Round 3 -->
  <rect x="30" y="305" width="740" height="125" rx="8" fill="#2a1e3a" stroke="#9b59b6" stroke-width="2"/>
  <text x="50" y="325" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#9b59b6">ROUND 3 : Application du fix</text>

  <text x="50" y="348" font-family="Arial, sans-serif" font-size="9" fill="#cccccc">9. LLM confirme le bug et propose un fix</text>
  <text x="70" y="361" font-family="monospace" font-size="8" fill="#888888">→ Thinking : "Division par zero possible quand divisor = 0"</text>
  <text x="70" y="374" font-family="monospace" font-size="8" fill="#888888">→ tool_call(edit_file, { path: "src/utils/math.ts", ... })</text>

  <text x="50" y="394" font-family="Arial, sans-serif" font-size="9" fill="#cccccc">10. SECURITY verifie</text>
  <text x="70" y="407" font-family="monospace" font-size="8" fill="#9b59b6">→ edit_file dans working dir = auto-approved</text>

  <text x="50" y="424" font-family="Arial, sans-serif" font-size="9" fill="#2ecc71">11. ACTION execute l'edition → Fichier modifie avec succes</text>

  <!-- Round 4 -->
  <rect x="30" y="440" width="740" height="100" rx="8" fill="#1e2a3a" stroke="#3498db" stroke-width="2"/>
  <text x="50" y="460" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#3498db">ROUND 4 : Verification</text>

  <text x="50" y="483" font-family="Arial, sans-serif" font-size="9" fill="#cccccc">12. LLM propose de verifier le fix</text>
  <text x="70" y="496" font-family="monospace" font-size="8" fill="#888888">→ tool_call(bash, { command: "npm test" })</text>

  <text x="50" y="513" font-family="Arial, sans-serif" font-size="9" fill="#cccccc">13. SECURITY verifie → "npm test" = commande safe = auto-approved</text>

  <text x="50" y="533" font-family="Arial, sans-serif" font-size="9" fill="#2ecc71">14. ACTION execute les tests → "23 tests passed, 0 failed"</text>

  <!-- Round 5 -->
  <rect x="30" y="550" width="740" height="110" rx="8" fill="#3a1e2a" stroke="#e74c3c" stroke-width="2"/>
  <text x="50" y="570" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#e74c3c">ROUND 5 : Conclusion</text>

  <text x="50" y="593" font-family="Arial, sans-serif" font-size="9" fill="#cccccc">15. LEARNING enregistre le pattern</text>
  <text x="70" y="606" font-family="monospace" font-size="8" fill="#888888">→ Nouveau pattern : "division by zero" → "add guard check" (confidence: 0.7)</text>

  <text x="50" y="626" font-family="Arial, sans-serif" font-size="9" fill="#cccccc">16. LLM genere la reponse finale (pas de tool_call)</text>
  <text x="70" y="639" font-family="monospace" font-size="8" fill="#888888">→ "J'ai trouve et corrige le bug ! Le probleme etait..."</text>

  <text x="50" y="656" font-family="Arial, sans-serif" font-size="9" fill="#2ecc71">17. ORCHESTRATEUR termine → Boucle terminee apres 5 rounds</text>

  <!-- Statistics -->
  <rect x="30" y="675" width="740" height="105" rx="8" fill="#2d2d44" stroke="#4a4a6a" stroke-width="2"/>
  <text x="400" y="695" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#ffffff" text-anchor="middle">STATISTIQUES DE LA REQUETE</text>

  <text x="100" y="720" font-family="monospace" font-size="10" fill="#cccccc">Rounds</text>
  <text x="100" y="735" font-family="monospace" font-size="10" fill="#2ecc71">5</text>

  <text x="200" y="720" font-family="monospace" font-size="10" fill="#cccccc">Tool calls</text>
  <text x="200" y="735" font-family="monospace" font-size="10" fill="#f39c12">4</text>

  <text x="320" y="720" font-family="monospace" font-size="10" fill="#cccccc">Tokens utilises</text>
  <text x="320" y="735" font-family="monospace" font-size="10" fill="#9b59b6">~18,500</text>

  <text x="480" y="720" font-family="monospace" font-size="10" fill="#cccccc">Duree totale</text>
  <text x="480" y="735" font-family="monospace" font-size="10" fill="#3498db">~25 secondes</text>

  <text x="620" y="720" font-family="monospace" font-size="10" fill="#cccccc">Cout estime</text>
  <text x="620" y="735" font-family="monospace" font-size="10" fill="#e74c3c">~$0.08</text>

  <text x="100" y="765" font-family="Arial, sans-serif" font-size="9" fill="#888888">Outils : read_file, search_content, edit_file, bash</text>

  <!-- Component Legend -->
  <rect x="30" y="795" width="740" height="90" rx="8" fill="#1a1a2e" stroke="#4a4a6a" stroke-width="1"/>
  <text x="400" y="815" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#ffffff" text-anchor="middle">Composants impliques</text>

  <rect x="60" y="830" width="100" height="20" rx="4" fill="#1e3a3a"/>
  <text x="110" y="844" font-family="Arial, sans-serif" font-size="9" fill="#2ecc71" text-anchor="middle">Orchestrateur</text>

  <rect x="180" y="830" width="100" height="20" rx="4" fill="#3a3a1e"/>
  <text x="230" y="844" font-family="Arial, sans-serif" font-size="9" fill="#f39c12" text-anchor="middle">Reasoning</text>

  <rect x="300" y="830" width="100" height="20" rx="4" fill="#2a1e3a"/>
  <text x="350" y="844" font-family="Arial, sans-serif" font-size="9" fill="#9b59b6" text-anchor="middle">Memory</text>

  <rect x="420" y="830" width="100" height="20" rx="4" fill="#1e2a3a"/>
  <text x="470" y="844" font-family="Arial, sans-serif" font-size="9" fill="#3498db" text-anchor="middle">Action</text>

  <rect x="540" y="830" width="100" height="20" rx="4" fill="#3a1e2a"/>
  <text x="590" y="844" font-family="Arial, sans-serif" font-size="9" fill="#e74c3c" text-anchor="middle">Security</text>

  <rect x="660" y="830" width="100" height="20" rx="4" fill="#2d2d44"/>
  <text x="710" y="844" font-family="Arial, sans-serif" font-size="9" fill="#cccccc" text-anchor="middle">Learning</text>

  <text x="400" y="875" font-family="Arial, sans-serif" font-size="10" fill="#888888" text-anchor="middle">Les 6 composants collaborent pour resoudre la tache de bout en bout</text>
</svg>
